{
    "info": {
        "_postman_id": "pld-api-collection",
        "name": "PLD API - Sistema de Alertas",
        "description": "Colección completa para probar el sistema de PLD incluyendo operaciones, pagos y generación de alertas",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "Operaciones",
            "item": [
                {
                    "name": "Insertar Operación",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 201\", function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test(\"Response has IDOperacion\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('IDOperacion');",
                                    "});",
                                    "",
                                    "// Guardar IDOperacion para usar en otros requests",
                                    "if (pm.response.code === 201) {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.environment.set(\"lastOperacionId\", jsonData.IDOperacion);",
                                    "    pm.environment.set(\"lastFolioPoliza\", jsonData.FolioPoliza);",
                                    "    pm.environment.set(\"lastFolioEndoso\", jsonData.FolioEndoso);",
                                    "    console.log(\"Operación guardada:\", jsonData.IDOperacion);",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"IDCliente\": 1,\n  \"FolioPoliza\": \"POL-{{$randomInt}}\",\n  \"FolioEndoso\": \"END-{{$randomInt}}\",\n  \"FechaEmision\": \"2024-01-15\",\n  \"PrimaTotal\": 50000.00,\n  \"IDMoneda\": 1,\n  \"FechaInicioVigencia\": \"2024-01-15\",\n  \"FechaFinVigencia\": \"2025-01-14\",\n  \"GastosEmision\": 1500.00,\n  \"RFCAgente\": \"RFCAGT123456789\",\n  \"CURPAgente\": \"CURAGT123456789012\",\n  \"NombreAgente\": \"Juan\",\n  \"APaternoAgente\": \"Pérez\",\n  \"AMaternoAgente\": \"López\",\n  \"RazonSocialAgente\": \"Agente de Seguros SA de CV\",\n  \"tipoDocumento\": \"poliza\",\n  \"DetalleBeneficiarios\": [\n    {\n      \"RFC\": \"RFCBEN123456789\",\n      \"CURP\": \"CURBEN123456789012\",\n      \"nombre\": \"María\",\n      \"apellidoPaterno\": \"García\",\n      \"apellidoMaterno\": \"Martínez\",\n      \"razonSocial\": null,\n      \"preferente\": true,\n      \"porcentajeParticipacion\": 100\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones",
                            "host": ["{{baseUrl}}"],
                            "path": ["api", "operaciones"]
                        }
                    },
                    "response": []
                }
            ],
            "description": "Endpoints para gestión de operaciones de seguros"
        },
        {
            "name": "Pagos y Alertas",
            "item": [
                {
                    "name": "Pago Fraccionado (Sin tolerancia - Debe generar alerta)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 201\", function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test(\"Payment details saved\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    pm.expect(jsonData.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "console.log(\"Pago fraccionado procesado para generar alerta\");"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"IDCliente\": 1,\n  \"montoPagado\": 51500.00,\n  \"IDMoneda\": 1,\n  \"IDFormaPago\": 2,\n  \"TipoCambio\": 1.0,\n  \"FechaPago\": \"2024-01-20\",\n  \"detalleOperaciones\": [\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 25000.00\n    },\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 26500.00\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones/pagos",
                            "host": ["{{baseUrl}}"],
                            "path": ["api", "operaciones", "pagos"]
                        }
                    },
                    "response": []
                },
                {
                    "name": "Pago Fraccionado (Con tolerancia - No debe generar alerta)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 201\", function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test(\"Payment details saved\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    pm.expect(jsonData.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "console.log(\"Pago fraccionado procesado (dentro de tolerancia)\");"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"IDCliente\": 1,\n  \"montoPagado\": 51500.00,\n  \"IDMoneda\": 1,\n  \"IDFormaPago\": 2,\n  \"TipoCambio\": 1.0,\n  \"FechaPago\": \"2024-01-21\",\n  \"detalleOperaciones\": [\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 51500.00\n    },\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 51500.00\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones/pagos",
                            "host": ["{{baseUrl}}"],
                            "path": ["api", "operaciones", "pagos"]
                        }
                    },
                    "response": []
                },
                {
                    "name": "Pagos Acumulados en Efectivo",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 201\", function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test(\"Payment details saved\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    pm.expect(jsonData.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "console.log(\"Pagos acumulados en efectivo procesados\");"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"IDCliente\": 1,\n  \"montoPagado\": 51500.00,\n  \"IDMoneda\": 1,\n  \"IDFormaPago\": 1,\n  \"TipoCambio\": 1.0,\n  \"FechaPago\": \"2024-01-22\",\n  \"detalleOperaciones\": [\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 25000.00\n    },\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 15000.00\n    },\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 11500.00\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones/pagos",
                            "host": ["{{baseUrl}}"],
                            "path": ["api", "operaciones", "pagos"]
                        }
                    },
                    "response": []
                },
                {
                    "name": "Pago por Monto Relevante (Efectivo - MXN)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 201\", function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test(\"Payment details saved\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    pm.expect(jsonData.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "console.log(\"Pago por monto relevante procesado\");"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"IDCliente\": 1,\n  \"montoPagado\": 250000.00,\n  \"IDMoneda\": 1,\n  \"IDFormaPago\": 1,\n  \"TipoCambio\": 1.0,\n  \"FechaPago\": \"2024-01-23\",\n  \"detalleOperaciones\": [\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 250000.00\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones/pagos",
                            "host": ["{{baseUrl}}"],
                            "path": ["api", "operaciones", "pagos"]
                        }
                    },
                    "response": []
                },
                {
                    "name": "Pago por Monto Relevante (Efectivo - USD)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 201\", function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test(\"Payment details saved\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    pm.expect(jsonData.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "console.log(\"Pago por monto relevante en USD procesado\");"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"IDCliente\": 1,\n  \"montoPagado\": 15000.00,\n  \"IDMoneda\": 2,\n  \"IDFormaPago\": 1,\n  \"TipoCambio\": 17.50,\n  \"FechaPago\": \"2024-01-24\",\n  \"detalleOperaciones\": [\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 15000.00\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones/pagos",
                            "host": ["{{baseUrl}}"],
                            "path": ["api", "operaciones", "pagos"]
                        }
                    },
                    "response": []
                },
                {
                    "name": "Pago por Monto Inusual (Prima Alta)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 201\", function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test(\"Payment details saved\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    pm.expect(jsonData.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "console.log(\"Pago por monto inusual procesado\");"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"IDCliente\": 1,\n  \"montoPagado\": 600000.00,\n  \"IDMoneda\": 1,\n  \"IDFormaPago\": 2,\n  \"TipoCambio\": 1.0,\n  \"FechaPago\": \"2024-01-25\",\n  \"detalleOperaciones\": [\n    {\n      \"folioPoliza\": \"{{lastFolioPoliza}}\",\n      \"folioEndoso\": \"{{lastFolioEndoso}}\",\n      \"detalleMontoPagado\": 600000.00\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones/pagos",
                            "host": ["{{baseUrl}}"],
                            "path": ["api", "operaciones", "pagos"]
                        }
                    },
                    "response": []
                },
                {
                    "name": "Pago PPE (Persona Políticamente Expuesta)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 201\", function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test(\"Payment details saved\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "    pm.expect(jsonData.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "console.log(\"Pago PPE procesado\");"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"IDCliente\": 2,\n  \"montoPagado\": 50000.00,\n  \"IDMoneda\": 1,\n  \"IDFormaPago\": 2,\n  \"TipoCambio\": 1.0,\n  \"FechaPago\": \"2024-01-26\",\n  \"detalleOperaciones\": [\n    {\n      \"folioPoliza\": \"POL-12345\",\n      \"folioEndoso\": \"END-67890\",\n      \"detalleMontoPagado\": 50000.00\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones/pagos",
                            "host": ["{{baseUrl}}"],
                            "path": ["api", "operaciones", "pagos"]
                        }
                    },
                    "response": []
                }
            ],
            "description": "Endpoints para procesar pagos y generar diferentes tipos de alertas PLD"
        },
        {
            "name": "Consultas",
            "item": [
                {
                    "name": "Consultar Alertas Generadas",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test(\"Response is array\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "});",
                                    "",
                                    "console.log(\"Alertas consultadas:\", pm.response.json().length);"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/alertas",
                            "host": ["{{baseUrl}}"],
                            "path": ["api", "alertas"]
                        }
                    },
                    "response": []
                },
                {
                    "name": "Consultar Pagos por Operación",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test(\"Response is array\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "});",
                                    "",
                                    "console.log(\"Pagos consultados:\", pm.response.json().length);"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones/{{lastOperacionId}}/pagos",
                            "host": ["{{baseUrl}}"],
                            "path": [
                                "api",
                                "operaciones",
                                "{{lastOperacionId}}",
                                "pagos"
                            ]
                        }
                    },
                    "response": []
                },
                {
                    "name": "Consultar Operación por ID",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test(\"Status code is 200\", function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test(\"Response has operation data\", function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('IDOperacion');",
                                    "    pm.expect(jsonData).to.have.property('PrimaTotal');",
                                    "});",
                                    "",
                                    "console.log(\"Operación consultada:\", pm.response.json().IDOperacion);"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Accept",
                                "value": "application/json"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/operaciones/{{lastOperacionId}}",
                            "host": ["{{baseUrl}}"],
                            "path": [
                                "api",
                                "operaciones",
                                "{{lastOperacionId}}"
                            ]
                        }
                    },
                    "response": []
                }
            ],
            "description": "Endpoints para consultar operaciones, pagos y alertas"
        }
    ],
    "event": [
        {
            "listen": "prerequest",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "// Configurar variables globales si no existen",
                    "if (!pm.environment.get(\"baseUrl\")) {",
                    "    pm.environment.set(\"baseUrl\", \"http://localhost:8000\");",
                    "}",
                    "",
                    "console.log(\"Iniciando request:\", pm.info.requestName);"
                ]
            }
        },
        {
            "listen": "test",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "if (pm.response.code >= 400) {",
                    "    console.error(\"Error en respuesta:\", pm.response.code, pm.response.json());",
                    "} else {",
                    "    console.log(\"Response OK:\", pm.response.code);",
                    "}"
                ]
            }
        }
    ],
    "variable": [
        {
            "key": "baseUrl",
            "value": "http://localhost:8000",
            "type": "string"
        }
    ]
}
